// ==UserScript==
// @name         Generals Custom Games Helper
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  Improves your gaming experience
// @author       jwcub
// @supportURL   https://github.com/jwcub/GeneralsCustomGamesHelper
// @match        https://generals.io/*
// @require      https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js
// @grant        none
// ==/UserScript==
!function(t){"use strict";var e=e=>{e.on("game_start",(async({options:{map:e}})=>{if(!e)return;let s,a;!function(){if(0===document.body.children.length)return;const t=document.body.children[0];document.body.removeChild(t),document.children[0].prepend(t)}();try{s=(await function(t){return fetch("/api/map?name="+t).then((t=>t.json()))}(e)).map}catch(t){return}s=s.split(",").map((t=>t.replace(/^L_/,""))),a=setInterval((()=>{const e=t("#gameMap td");if(e.length!==s.length)return;function n(t){const a=s[t],n=e[t];if(n.classList.contains("fog")||n.classList.contains("obstacle")){if(n.classList.remove("fog","obstacle"),"m"===a)return n.classList.add("mountain"),!0;if("s"===a)return n.classList.add("swamp"),!0;if("g"===a[0])return n.classList.add("teal","general"),!0;if("n"===a[0])return n.classList.add("neutral"),!0;if(" "!==a)return n.classList.add("city"),!0;n.classList.add("fog")}return!1}clearInterval(a);const c={attributes:!0};for(let t=0;t<s.length;t++)if(n(t)){new MutationObserver((()=>setTimeout((()=>n(t)),100))).observe(e[t],c)}}),500)}))};let s;s=setInterval((()=>{window.location.href.startsWith("https://generals.io/games/")&&socket&&(clearInterval(s),console.log("plugin entry"),t("#custom-queue-ad-top, #custom-queue-ad, #custom-queue-ad-skyscraper").remove(),(e=>{const s=window.location.href.match(/games\/([\s\S]*)$/)[1];e.on("queue_update",(({usernames:a})=>{if(t(".trigger").remove(),0!==t(".custom-host-message[style='background-color: teal;']").length)for(let n of t(".custom-team-container"))if("Spectators"===n.children[0].innerText)for(let c=1;c<n.children.length;c++){const r=n.children[c];if(r.children.length>1)continue;const i=r.innerText,o=document.createElement("a");t(o).addClass("inline-color-block-hover trigger").html('\n<svg class="hover-show" viewBox="0 0 1024 700" width="13px" height="13px" xmlns="http://www.w3.org/2000/svg"><path class="white" d="M 880.038 439.253 L 904.318 456.072 L 897.869 452.405 C 894.454 450.508 888.89 446.714 885.728 444.059 L 880.038 439.253 Z M 569.572 219.612 C 569.611 219.541 560.983 232.619 561.362 233.505 C 562.247 235.781 712.606 488.698 713.871 490.089 C 714.756 490.975 856.516 415.605 859.678 412.57 C 860.184 412.065 859.487 412.182 857.907 401.695 C 857.869 401.441 936.286 461.758 948.366 461.763 C 948.619 461.763 936.439 462.015 936.439 462.142 C 936.439 462.395 869.415 747.938 869.415 747.938 L 869.415 889.192 L 153.659 889.192 L 153.659 748.318 L 120.654 607.949 C 102.57 530.683 87.395 466.189 87.015 464.544 C 86.51 462.142 75.106 461.731 75.242 461.763 C 87.126 464.578 165.848 397.97 165.748 398.334 C 162.598 409.746 165.293 404.856 162.638 409.662 C 161.626 411.559 308.571 490.595 309.203 490.089 C 310.468 488.825 460.953 235.655 461.839 233.378 C 462.092 232.619 452.962 222.44 453.113 222.63 C 461.658 233.343 561.641 233.899 569.572 219.612 Z" style="stroke-width: 0;"></path><path class="white" d="M 504 297.2 m -82.074 0 a 82.074 82.074 0 1 0 164.148 0 a 82.074 82.074 0 1 0 -164.148 0 Z M 504 297.2 m -49.243 0 a 49.243 49.243 0 0 1 98.486 0 a 49.243 49.243 0 0 1 -98.486 0 Z" transform="matrix(0.352455, -0.935829, 0.935829, 0.352455, -370.007055, 747.229931)"></path><path class="white" d="M 504 297.2 m -82.074 0 a 82.074 82.074 0 1 0 164.148 0 a 82.074 82.074 0 1 0 -164.148 0 Z M 504 297.2 m -49.243 0 a 49.243 49.243 0 0 1 98.486 0 a 49.243 49.243 0 0 1 -98.486 0 Z" transform="matrix(0.352455, -0.935829, 0.935829, 0.352455, 481.352607, 746.899791)"></path><path class="white" d="M 504 297.2 m -82.074 0 a 82.074 82.074 0 1 0 164.148 0 a 82.074 82.074 0 1 0 -164.148 0 Z M 504 297.2 m -49.243 0 a 49.243 49.243 0 0 1 98.486 0 a 49.243 49.243 0 0 1 -98.486 0 Z" transform="matrix(0.352455, -0.935829, 0.935829, 0.352455, 55.318002, 530.920357)"></path><circle class="white" cx="86.928" cy="376.918" r="66.167"></circle><circle class="white" cx="518.083" cy="166.811" r="66.564"></circle><circle class="white" cx="944.862" cy="379.106" r="64.369"></circle></svg><span class="inline-color-block hover-false white"></span>\n').css("display","inline-block").css("width","10px").click((()=>e.emit("set_custom_host",s,a.indexOf(i)))),r.prepend(o)}}))})(socket),e(socket))}),1e3)}($);
